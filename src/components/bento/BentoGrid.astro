---
import { SITE, SOCIAL_LINKS } from '@/consts'
import { Icon } from 'astro-icon/components'

import { getBlogCollection, sortMDByDate } from 'astro-pure/server'
import DiscordPresence from '@/components/bento/DiscordPresence.tsx'
import GithubCalendar from '@/components/bento/GithubCalendar.tsx'
import HousePostCanvas from '@/components/bento/HousePostCanvas.tsx'
import SplineCanvas from '@/components/bento/SplineCanvas.tsx'
import SpotifyPresence from '@/components/bento/SpotifyPresence.tsx'
import ThreeCanvas from '@/components/bento/ThreeCanvas.tsx'
import WakatimeGraph from '@/components/bento/WakatimeGraph.tsx'
import Link from '@/components/Link.astro'

// const allPosts = await getBlogCollection()
// const latestPost = sortMDByDate(allPosts).filter((post) => !post.data.draft).at(0)
---

<section
  class="mx-auto grid max-w-[375px] grid-cols-2 gap-4 px-4 [grid-template-areas:'a_a'_'a_a'_'b_b'_'b_b'_'e_e'_'h_i'_'h_c'_'k_c'_'d_d'_'d_d'_'g_g'_'g_g'_'f_f'_'j_j'_'j_j'] *:rounded-3xl *:border *:bg-secondary/25 *:bg-cover *:bg-center *:bg-no-repeat sm:max-w-screen-sm sm:[grid-template-areas:'a_a'_'b_d'_'e_e'_'j_g'_'h_i'_'h_c'_'k_c'_'f_f'] xl:max-w-screen-xl xl:grid-cols-4 xl:[grid-template-areas:'a_a_b_c'_'d_e_e_c'_'h_e_e_g'_'h_i_j_k'] xl:[&:hover:has(>.has-overlay:hover)>.first>.overlay]:opacity-100 xl:[&:hover>*:not(.first):hover_.overlay]:opacity-100"
  aria-label='Personal information and activity grid'
>
  <div
    class="first aspect-square rounded-3xl border bg-[url('/bento/about-square.webp')] bg-cover bg-center bg-no-repeat [grid-area:a] sm:aspect-[2.1/1] sm:bg-[url('/bento/about.webp')] xl:aspect-auto"
    role='img'
    aria-label='Introduction'
  >
    <div
      class="overlay size-full rounded-3xl bg-[url('/bento/about-silhouette.webp')] bg-cover bg-center bg-no-repeat opacity-0 transition-opacity duration-200"
    >
    </div>
  </div>

  <div
    class="has-overlay aspect-square [grid-area:b] xl:bg-[url('/bento/details-silhouette.webp')]"
    role='img'
    aria-label='Details'
  >
    <div
      class="overlay size-full rounded-3xl bg-[url('/bento/details.webp')] bg-cover bg-center bg-no-repeat transition-opacity duration-200 xl:opacity-0"
    >
    </div>
  </div>

  <div
    class="aspect-[1/2.1] bg-[url('/bento/image-1.webp')] [grid-area:c] xl:aspect-auto"
    aria-hidden='true'
  >
  </div>

  <div class='relative overflow-hidden [grid-area:g] sm:aspect-square size-full'>
    <div style={{ width: '100%', height: '100%' }}>
      <DiscordPresence client:load />
    </div>
  </div>

  <div
    class='three-canvas-container has-overlay relative flex aspect-[6/5] items-center justify-center overflow-hidden p-4 [grid-area:e] hover:bg-none sm:aspect-[2.1/1] xl:aspect-auto'
  >
    <SplineCanvas client:only='react' />
    {
      /* <ThreeCanvas
      client:load
      modelPath='/ophanim_angel.glb'
      cameraZ={5}
      playAnimation={true}
      autoRotate={false}
      initialRotationY={Math.PI / 2}
    /> */
    }
  </div>

  <!-- Blog and Github contributions -->
  <!-- <div
      class="has-overlay relative flex aspect-[6/5] items-start overflow-hidden p-4 [grid-area:e] hover:bg-none sm:aspect-[2.1/1] sm:items-center xl:aspect-auto xl:bg-[url('/bento/blog-silhouette.webp')]"
    >
      <div
        class="overlay absolute inset-0 size-full rounded-3xl bg-[url('/bento/blog-square.webp')] bg-cover bg-center bg-no-repeat transition-opacity duration-200 sm:bg-[url('/bento/blog.webp')] xl:opacity-0"
      >
      </div>
      {/*
      {
        latestPost && (
          <>
            <img
              src={latestPost.data.heroImage?.src ?? '#'}
              alt={`Featured image for the latest post: ${latestPost.data.title}`}
              width={477}
              height={251}
              class="w-full rounded-2xl border border-border sm:ml-2 sm:w-[80%]"
            />
            <Link
              href={`/blog/${latestPost.id}`}
              aria-label={`Read latest blog post: ${latestPost.data.title}`}
              title={`Read latest blog post: ${latestPost.data.title}`}
            >
              <div class="absolute bottom-0 right-0 m-3 flex w-fit items-end rounded-full border bg-secondary/50 p-3 text-primary transition-all duration-300 hover:rotate-12 hover:ring-1 hover:ring-primary">
                <Icon name="lucide:move-up-right" size={16} />
              </div>
            </Link>
          </>
        )
      }
      */}
    </div> -->

  <!-- <div
      class="has-overlay relative flex aspect-square items-center justify-center overflow-hidden [grid-area:f] hover:bg-none sm:aspect-[2.1/1] xl:aspect-auto xl:bg-[url('/bento/contributions-silhouette.webp')]"
    >
      <div
        class="overlay absolute inset-0 z-[1] size-full rounded-3xl bg-[url('/bento/contributions-square.webp')] bg-cover bg-center bg-no-repeat transition-opacity duration-200 sm:bg-[url('/bento/contributions.webp')] xl:opacity-0"
      >
      </div>
      <GithubCalendar username="yohn-maistre" client:load />
    </div> -->

  <div
    class="has-overlay relative aspect-square [grid-area:d] hover:bg-none xl:bg-[url('/bento/spotify-silhouette.webp')] size-full"
  >
    <div style={{ width: '100%', height: '100%' }}>
      <div
        class="overlay absolute inset-0 z-0 size-full rounded-3xl bg-[url('/bento/spotify.webp')] bg-cover bg-center bg-no-repeat transition-opacity duration-200 xl:opacity-0"
      >
      </div>
      <SpotifyPresence client:load />
    </div>
  </div>

  <div class='aspect-[1/2.1] [grid-area:h] xl:aspect-auto' aria-hidden='true'>
    <HousePostCanvas client:only='react' />
  </div>

  <div
    class="has-overlay relative flex aspect-square items-center justify-center [grid-area:i] hover:bg-none xl:bg-[url('/bento/github-silhouette.webp')]"
  >
    <div
      class="overlay absolute inset-0 size-full rounded-3xl bg-[url('/bento/github.webp')] bg-cover bg-center bg-no-repeat transition-opacity duration-200 xl:opacity-0"
    >
    </div>
    <Icon
      name='mdi:github'
      class='absolute z-[1] size-1/2 text-primary sm:size-24'
      aria-hidden='true'
    />
    <Link
      href={SOCIAL_LINKS.find((link) => link.label === 'GitHub')?.href || '#'}
      title='Visit my GitHub profile'
      aria-label='Visit my GitHub profile'
    >
      <div
        class='absolute bottom-0 right-0 m-3 flex w-fit items-end rounded-full border bg-secondary/50 p-3 text-primary transition-all duration-300 hover:rotate-12 hover:ring-1 hover:ring-primary'
      >
        <Icon name='lucide:move-up-right' size={16} />
      </div>
    </Link>
  </div>

  <div class='aspect-square [grid-area:j] size-full'>
    <div style={{ width: '100%', height: '100%' }}>
      <WakatimeGraph omitLanguages={['Markdown', 'JSON']} client:load />
    </div>
  </div>

  <div
    class="has-overlay relative flex aspect-square items-center justify-center [grid-area:k] hover:bg-none xl:bg-[url('/bento/twitter-silhouette.webp')]"
  >
    <div
      class="overlay absolute inset-0 size-full rounded-3xl bg-[url('/bento/twitter.webp')] bg-cover bg-center bg-no-repeat transition-opacity duration-200 xl:opacity-0"
    >
    </div>
    <Icon
      name='mdi:twitter'
      class='absolute z-[1] size-1/2 text-primary sm:size-24'
      aria-hidden='true'
    />
    <Link
      href={SOCIAL_LINKS.find((link) => link.label === 'Twitter')?.href || '#'}
      title='Visit my Twitter profile'
      aria-label='Visit my Twitter profile'
    >
      <div
        class='absolute bottom-0 right-0 m-3 flex w-fit items-end rounded-full border bg-secondary/50 p-3 text-primary transition-all duration-300 hover:rotate-12 hover:ring-1 hover:ring-primary'
      >
        <Icon name='lucide:move-up-right' size={16} />
      </div>
    </Link>
  </div>
</section>

<style>
  .three-canvas-container {
    background: transparent !important;
    border: none !important;
    padding: 0 !important;
  }
</style>
